
<main>
    <p>
    <p>Create your account.</p>
    </p>
    <form id="registerForm">
        <div>
            <label for="username">Username</label>
            <input type="text" id="username" name="username" placeholder="Enter your Username">
        </div>
        <div>
            <label for="state">State</label>
            <input type="text" id="state" name="state" placeholder="Enter your State" required>
        </div>
        <div>
            <label for="city">City</label>
            <input type="text" id="city" name="city" placeholder="Enter your City" required>
        </div>
        <div>
            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="Enter your Password">
        </div>
        <div>
            <p id="errorMsg" style="color:red"></p>
        </div>
        <button class="my-btn" type="submit">Create account</button>
    </form>
    <a href="/">Already have an account? Click here to Log-in</a>

</main>


<script>
    (function () {
        const errorState = document.getElementById('errorMsg');

        const form = document.querySelector('#registerForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const city = document.getElementById('city').value;
            const state = document.getElementById('state').value;

            if (!username || !password) {
                errorState.innerHTML = "Enter the username and password.";
                return;
            }
            if (!city || city.trim().length === 0) {
                errorState.innerHTML = "Enter city.";
                return;
            }
            if (!state || state.trim().length === 0) {
                errorState.innerHTML = "Enter state.";
                return;
            }
            if (username.length < 4) {
                errorState.innerHTML = "username must be at least 4 char alphanumeric.";
                return;
            }
            if (password.length < 6) {
                errorState.innerHTML = "password must be at least 6 char with at least one capital, one small, one number and one special char.";
                return;
            }
            errorState.innerHTML = ""
            const xhr = new XMLHttpRequest()
            xhr.open('POST', '/register')

            let data = new FormData(form)

            // set headers
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            console.log(`username=${username}&password=${password}&city=${city}&state=${state}`)
            xhr.send(`username=${username}&password=${password}&city=${city}&state=${state}`)

            // listen for `load` event
            xhr.onload = () => {
                console.log(xhr.responseText)
                const res = JSON.parse(xhr.responseText);
                if (res.status && res.status == "success") {
                    window.location.replace("http://localhost:3000/");
                } else {
                    errorState.innerHTML = res.message;
                }

            }
        })
    })()

</script>